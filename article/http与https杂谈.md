# HTTP与HTTPS的区别与优点
## HTTP协议
### 什么是HTTP?
* **HTTP**：   
> * 超文本传输协议，是一个基于请求与响应，无状态的，应用层的协议，常基于TCP/IP协议传输数据，互联网上应用最为广泛的一种网络协议,所有的WWW文件都必须遵守这个标准。   
> * 设计HTTP的初衷是为了提供一种发布和接收HTML页面的方法。  
* 发展历史：  

|版本|产生时间|内容|发展现状|
|:--:|:--:|:--:|:--:|
|HTTP/0.9|1991年|不涉及数据包传输，规定客户端和服务器之间通信格式，只能GET请求|没有作为正式的标准|
|HTTP/1.0|1996年|传输内容格式不限制，增加PUT、PATCH、HEAD、 OPTIONS、DELETE命令|正式作为标准|
|HTTP/1.1|1997年|持久连接(长连接)、节约带宽、HOST域、管道机制、分块传输编码|2015年前使用最广泛|
|HTTP/2|2015年|多路复用、服务器推送、头信息压缩、二进制协议等|逐渐覆盖市场|
### 什么是HTTPS？
* **HTTPS**：  
> * HTTPS是身披SSL外壳的HTTP-以安全为目标的HTTP通道，简单讲是HTTP的安全版，即HTTP下加入SSL层，HTTPS的安全基础是SSL，因此加密的详细内容就需要SSL。  ![image.png](https://i.loli.net/2020/06/05/3L4XrMPQ2s18aui.png)
> * HTTPS是一种通过计算机网络进行安全通信的传输协议，经由HTTP进行通信，利用SSL/TLS建立全信道，加密数据包。  
> * HTTPS使用的主要目的是提供对网站服务器的身份认证，同时保护交换数据的隐私与完整性。  
> * PS:TLS是传输层加密协议，前身是SSL协议，由网景公司1995年发布，有时候两者不区分。  
### HTTP协议的特点
* **HTTP特点：**  
> * 无状态：协议对客户端没有状态存储，对事物处理没有“记忆”能力，比如访问一个网站需要反复进行登录操作  
> * 无连接：HTTP/1.1之前，由于无状态特点，每次请求需要通过TCP三次握手四次挥手，和服务器重新建立连接。比如某个客户机在短时间多次请求同一个资源，服务器并不能区别是否已经响应过用户的请求，所以每次需要重新响应请求，需要耗费不必要的时间和流量。  
> * 基于请求和响应：基本的特性，由客户端发起请求，服务端响应  
> * 简单快速、灵活  
* **简单解决无状态的办法**  
> 1. 通过Cookie/Session技术  
> 2. HTTP/1.1持久连接（HTTP keep-alive）方法，只要任意一端没有明确提出断开连接，则保持TCP连接状态，在请求首部字段中的Connection: keep-alive即为表明使用了持久连接  
### 为什么需要HTTPS？
> HTTP通信：  
> * 通信使用明文、请求和响应不会对通信方进行确认、无法保护数据的完整性  

**为了方便理解，我们来模拟个场景**：  
> 克莱恩 和 奥黛丽 某天通过电报隐秘的交谈着  
> 克莱恩：  
* “最近，贝克兰德发生了一件大事你知道么？”  
> 奥黛丽炸了眨眼：  
* “什么呀？”  
> 克莱恩：  
* “黑夜教堂被人潜入了，红手套们发现……”  
> 聊了一会……  
* “不对，我们这样聊天会被人窃听到的，”
> 克莱恩突然意识到：  
![image.png](https://i.loli.net/2020/06/04/tNpGHCwKYOZ9hec.png)
* “我们得找个隐秘点的方式！”  
> 奥黛丽沉思少许……兴奋的说：  
* “不如，我们给电报的信息加上密码，想用某个字就用黑夜女神的教典第几页第几行第几个字 的序号来替换，这样，别人就看不懂了！”![image.png](https://i.loli.net/2020/06/05/Ai7n6TRc5eISdXo.png)  
> * 这就是**对称加密**  
>> * 对称加密就是，将信息和私钥通过某种算法混合在一起，这样除非知道私钥，不然无法获取内容，而正好客户端和服务端都知道这个私钥，所以只要加密算法够彪悍，私钥够复杂，数据就够安全。  

> 克莱恩说：  
* “有道理，那我们用密文聊天吧~”  
> 几天后……
* “奥黛丽，快出来，不对啊，我发现问题了！”  
* “怎么了？”  
> 奥黛丽好奇的问道：  
* “我们之前商量好的加密我发现个问题，如果我们约定好的加密方式，被其他人拦截到了加密方式，别人不就能直接破译我们的聊天内容了！”  
> 奥黛丽一想，眉头瞬间怵起来：  
> 克莱尔说：  
* “不如这样，我们使用另一种加密方式-非对称加密”  
>> * ***非对称加密***：  
>> * 非对称加密是指 加密方拥有一个公有密匙和一个私有密匙。  
>> * **公有密匙可以对外暴露，而私有密匙只有自己可见**。  
>> * 使用公有密匙加密的消息，只有对应的私有密匙才能解开。  
>> * 反过来，使用私有密匙加密的消息，只有公有密匙才能解开。
>> * 这样客户端在发送消息前，先用服务器的公匙对消息进行加密，服务器收到后再用自己的私匙进行解密。  
* “我向你通信时，我先给你发个 `在么？` ”  
* “你如果收到了，给我回个 `在的，并返回我一个加密的公钥`”  
* “我收到了你发给我的公钥信息，把 `我的公钥/聊天信息` 用你的`公钥加密`发送给你，除了你，没人能看懂我发了什么，而你用我的公钥加密的也只有我能看懂！”  
![image.png](https://i.loli.net/2020/06/04/VsNFBt8vcdJmwrC.png)
> 奥黛丽听完，按捺住欣喜：  
* “就这么办……”  
> 几天后  
* “克莱恩，我发现这样不行啊，好累啊，每次加密后的文字太长了，我打得手都酸了……”  
> 奥黛丽微微鼓了鼓腮帮子，觉得这样不淑女，赶紧停止：  
> 克莱恩觉得也是，每次加密太浪费时间了  
* “不如这样，你给我发信息，我返回给你 公钥 ，奥黛丽你再自己随机产生一个加密方式[对称加密]，将加密方式 用我发给你的公钥加密后再发送给我，我用我的私钥解密，得到 解密后的 你发给我的加密方式，使用这个加密方式聊天。”  
* “这个方式，确保了 密码的安全性，还能避免 每次都使用非对称加密，只在关键时刻使用它，正常聊天使用 对称加密，发送信息和加解密就不用这么费劲啦！”  
![image.png](https://i.loli.net/2020/06/04/YK1XdgnG3ZaDCJe.png)
* “没问题，就这样做呀！”  
> 奥黛丽很高兴的同意了。  
> 好景不长  
* “克莱恩，如果，我们电报被人劫持了，从你第一封电报开始，”  

* “那个中间人将你第一封电报截取，给我发了个 `在么`，我收到 中间人 发给我的 `在么`，然后 给他返回个 `奥黛丽公钥`，隐秘人 再将自己的 `中间人公钥` 发送给你，你用 `中间人公钥` 加密 `对称算法的秘钥` 他用 自己的 `中间人私钥` 解密了你用他`中间人公钥`加密后的 `对称算法秘钥`，再将 `对称算法秘钥` 用`奥黛丽公钥` 加密后发送给我，那我们岂不是收到的都是他处理过的信息，他还是能看到我们的全部通信信息？好可怕啊~”  
> 克莱恩汗毛瞬间炸起，耳边方法传来不知名的呓语：  
> 他额角发汗，大脑急速运转，灵光一闪：  
* “有了，我们这样吧，”  
* “我们向伟大的愚者请求帮助，`服务方`先用公钥向愚者`申请`，获得认证授权，伟大的愚者直接将 `认证证书` 发送给 接收方，接收方收到 服务方信息时先将愚者认证证书 和接收到的信息里的证书比对，确保不是中间人发送截取伪造的数据；然后，再进行加密通讯！”
![image.png](https://i.loli.net/2020/06/05/1bLAEWD73j4mhcU.png)
![image.png](https://i.loli.net/2020/06/05/HubNjxlTPKt2ZRJ.png)
![image.png](https://i.loli.net/2020/06/05/GBMOYomzC2DQypx.png)  
>> CA认证流程：  
>> * 1、服务器拥有自己的私钥与公钥  

>> * 2、服务器将公钥交给CA认证机构，请求给予一份数字证书  

>> * 3、CA认证机构生成数字证书，并颁发给服务器  
>>> * 数字证书：  
>>>> * 包括了加密后服务器的公钥、权威机构的信息、服务器域名，还有经过CA私钥签名之后的证书内容（经过先通过Hash函数计算得到证书数字摘要，然后用权威机构私钥加密数字摘要得到数字签名)，签名计算方法以及证书对应的域名。  
>>> * 验证证书安全性过程  
>>>> * 当客户端收到这个证书之后，使用本地配置的权威机构的公钥对证书进行解密得到服务端的公钥和证书的数字签名，数字签名经过CA公钥解密得到证书信息摘要。  
然后证书签名的方法计算一下当前证书的信息摘要，与收到的信息摘要作对比，如果一样，表示证书一定是服务器下发的，没有被中间人篡改过。  
因为中间人虽然有权威机构的公钥，能够解析证书内容并篡改，但是篡改完成之后中间人需要将证书重新加密，但是中间人没有权威机构的私钥，无法加密，强行加密只会导致客户端无法解密，如果中间人强行乱修改证书，就会导致证书内容和证书签名不匹配。  
>>> * 那第三方攻击者能否让自己的证书显示出来的信息也是服务端呢？  
>>>> * （伪装服务端一样的配置）显然这个是不行的，因为当第三方攻击者去CA那边寻求认证的时候CA会要求其提供例如域名的whois信息、域名管理邮箱等证明你是服务端域名的拥有者，而第三方攻击者是无法提供这些信息所以他就是无法骗CA他拥有属于服务端的域名。  
>> * 4、服务器将带有公钥信息的数字证书发给客户端  

>> * 5、客户端将获得的证书 和 本地内置的证书 进行比对，确保正确后再进行对接的过程......  
![image.png](https://i.loli.net/2020/06/05/ak4TYho8Imwvq7d.png)

> 从此 克莱恩 和 奥黛丽 就开启了 随意聊 模式……  
#### HTTPS的缺点
* 虽然说HTTPS有很大的优势，但其相对来说，还是存在不足之处的：
> （1）HTTPS协议握手阶段比较费时，会使页面的加载时间延长近50%，增加10%到20%的耗电；  
> （2）HTTPS连接缓存不如HTTP高效，会增加数据开销和功耗，甚至已有的安全措施也会因此而受到影响；  
> （3）SSL证书需要钱，功能越强大的证书费用越高，个人网站、小网站没有必要一般不会用。  
> （4）SSL证书通常需要绑定IP，不能在同一IP上绑定多个域名，IPv4资源不可能支撑这个消耗。  
> （5）HTTPS协议的加密范围也比较有限，在黑客攻击、拒绝服务攻击、服务器劫持等方面几乎起不到什么作用。最关键的，SSL证书的信用链体系并不安全，特别是在某些国家可以控制CA根证书的情况下，中间人攻击一样可行。  
### HTTPS和HTTP的区别：
* 1） https协议要申请证书到ca，需要一定经济成本；  
* 2） http是明文传输，https是加密的安全传输；  
* 3） 连接的端口不一样，http是80，https是443；  
* 4）http连接很简单，没有状态；https是ssl加密的传输，身份认证的网络协议，相对http传输比较安全。   